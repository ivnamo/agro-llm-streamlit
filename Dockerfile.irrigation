# Dockerfile.irrigation
FROM python:3.11-slim

# Evitar bytecode y buffering
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

WORKDIR /app

# Instalar dependencias
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copiar TODO el repositorio (incluye cloud_run/ y common/)
COPY . .

# Puerto standard de Cloud Run
ENV PORT=8080

# Comando de arranque: ejecuta el main del agente de riego
# CMD ["python", "-m", "cloud_run.irrigation_agent.main"]
CMD ["functions-framework", "--target=run_irrigation_agent", "--port=8080", "--source=cloud_run/irrigation_agent/main.py"]
